# Colby News Wordpress Theme Development

- [Colby News Wordpress Theme Development](#colby-news-wordpress-theme-development)
  - [Development Requirements](#development-requirements)
  - [Storybook Component Library Development](#storybook-component-library-development)
    - [First Time Storybook Setup](#first-time-storybook-setup)
    - [Important Storybook Notes](#important-storybook-notes)
    - [Storybook CLI Commands](#storybook-cli-commands)
  - [WordPress Theme Development](#wordpress-theme-development)
    - [First Time WordPress Setup](#first-time-wordpress-setup)
    - [Important WordPress Notes](#important-wordpress-notes)
    - [Lando commands](#lando-commands)
  - [Troubleshooting](#troubleshooting)

## Development Requirements

- Node/NPM
- Lando (https://lando.dev/download/)
- Docker Desktop (included with Lando)

## Storybook Component Library Development

### First Time Storybook Setup

1. Run `npm install` to set up linting tools – primarily ESLint and
   specific configurations for it.
2. `npm start` - spins up the builder, storybook, and tailwind viewer containers.
3. When the log stops scrolling (probably with a `webpack built` message), visit
   `http://localhost:3000` to view the Storybook site.
4. When you are finished, use `npm stop`

### Important Storybook Notes

- Logs will begin displaying automatically when you use `npm start` or `npm restart`.
  To stop displaying the logs, use `ctl+c` in your terminal. This will not kill
  the running containers. You can bring them back up using `npm run logs`.

- Changes to the TailwindCSS config file (`./pattern-library/.builder-config/tailwind.config.js`)
  do not trigger a Storybook rebuild. Use `npm restart` after making changes to this file.

### Storybook CLI Commands

- `npm start`: start all containers for this project
- `npm stop`: stop all running containers for this project
- `npm restart`: stops and starts all containers
- `npm test`: Runs eslint and stylelint to check and fix formatting errors
- `npm run logs`: display running logs for all containers if you have
  manually stopped displaying them
- `npm run logs-storybook` / `npm run logs-builder`: displays running logs for
  only one of the running containers
- `npm run storybook-init`: run only the builder container

If you want to run `docker-compose` commands directly, you must pass the name of
the correct composer config file:

- `docker-compose --file storybook-compose.yml` followed by your normal arguments  
  For example, to start only the Storybook container, you could use  
  `docker-compose --file storybook-compose.yml start storybook`

## WordPress Theme Development

### First Time WordPress Setup

1. `lando rebuild`: This installs a local copy of WordPress and sets up a database with sample content.  
   The default admin user's login credentials are `admin / password`. You don't need to change these if
   you don't want to — this site only runs on your own computer.
2. The url for the local dev site will be https://colby-news.lndo.site. Note the `HTTPS`; this makes testing
   easier by eliminating warnings about insecure content, since the production site will be hosted with HTTPS.
3. To stop working with this site, use `lando stop`.
4. If you are done working with Lando altogether for a while, you can shut down its persistent network container
   using `lando poweroff`.

### Important WordPress Notes

- All of the custom stylesheets, scripts, images, and icons are generated by the Storybook builder.
  Until you have run `npm start` at least once, your WordPress site will look broken.
- Related: do not edit files in the theme's `assets` directory. They are generated outside of the
  theme by the Storybook builder and will be overwritten the next time the builder runs. They will
  also not be committed to the repository.
- Rebuilding the Lando project will wipe out any changes you have made to the local database unless
  you have updated the database backup file. If you think your changes should be part of the new default
  configuration, back them up using `lando db-default-rewrite`. If you want to store a snapshot specific
  to your machine that is not part of the repository, back it up using `lando db-backup` and restore
  it using `lando db-backup-restore` after rebuilding.

### Lando commands

To see a complete list of Lando commands for this project, run `lando` with no arguments.

The following commands are specific to this project or are likely to be used during development:

- `lando start`/`lando restart`: Starts up the local WordPress site without installing or updating anything.
- `lando stop`: Stops the running Lando containers for this project only, leaving container state intact.
- `lando rebuild`: Stops **and removes** any existing Lando containers for this project, then runs all of the
  initialization scripts (see "First Time WordPress Setup"). Data stored in volumes will not be deleted, but
  the database will be overwritten from the default backup in `wp-setup`.
- `lando destroy`: Resets the entire project, including all saved data. Use only if you are having problems,
  then follow it with `lando rebuild`.
- `lando db-default`: Replaces the current database with the default database.
- `lando db-rewrite`: Replaces the default database with the current database. Changes to the default database
  **will** be committed to the repository.
- `lando db-backup`: Saves the current database to a local file that is not part of the repository.
- `lando db-backup-restore`: Replaces the current database with the latest version backed up using `lando db-backup`
- `lando composer`/`lando composer-theme`: Pass-through commands to run composer in the project root or the
  theme directory, respectively.
- `lando pull-`
  - `db-prod` Pulls the database from the production site and imports it into your local database
  - `files` Syncs the local `uploads` directory with the remote `uploads` directory
  - `plugins` Syncs the local `plugins` directory with the remote `plugins` directory
- **Linting / Code Formatting commands:** There are a number of utilities for testing code quality, some of
  which are run during the deployment process. These can be run by prepending them with `lando`, and include:
  - `eslint`
  - `stylelint`
  - `phpcs`
  - `phpcbf`
- **General CLI utilities**: These passthrough commands will run in the root of the project:
  - `composer`
  - `npm`
  - `npx`
  - `rsync`
  - `scp`
  - `wget`

## Troubleshooting

If you are running into problems with containers crashing or failing to start up, or with
composer or npm installs not finishing, you can often resolve them by restarting
Docker Desktop. This will stop ALL running Docker containers, whether they belong to this
project or not, but should not affect your Docker volumes.
